<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Admin | Why Racing Events</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Oswald:wght@500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --brand-red: #E31837;
            --brand-dark: #000000;
            --brand-grey: #f4f4f4;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-dim: #666666;
            --border-color: #dddddd;
            --page-bg: #f8f8f8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--page-bg);
            color: var(--text-main);
            min-height: 100vh;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Password Gate */
        .password-gate {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .password-box {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .logo-placeholder {
            max-width: 180px;
            margin-bottom: 24px;
        }

        .password-box h1 {
            margin-bottom: 8px;
            color: var(--brand-dark);
            font-size: 20px;
        }

        .password-box p {
            color: #94a3b8;
            margin-bottom: 24px;
        }

        .password-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-main);
            font-size: 16px;
            margin-bottom: 16px;
        }

        .password-box input:focus {
            outline: none;
            border-color: var(--brand-red);
        }

        .password-box button {
            width: 100%;
            padding: 12px 24px;
            background: var(--brand-red);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .password-box button:hover {
            background: #b00e26;
            transform: translateY(-1px);
        }

        .password-error {
            color: #ef4444;
            margin-top: 12px;
            display: none;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--brand-red);
        }

        .admin-header h1 {
            color: var(--brand-red);
            font-size: 24px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #475569;
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            border-color: var(--brand-red);
            color: var(--brand-red);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 16px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: var(--border-color);
            color: var(--text-main);
        }

        .tab-btn.active {
            background: var(--brand-red);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Race List */
        .race-list {
            display: grid;
            gap: 16px;
        }

        .race-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .race-card:hover {
            border-color: var(--brand-red);
        }

        .race-card-info h3 {
            margin-bottom: 4px;
        }

        .race-card-info p {
            color: #94a3b8;
            font-size: 14px;
        }

        .race-card-status {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background: #166534;
            color: #bbf7d0;
        }

        .status-draft {
            background: #854d0e;
            color: #fef08a;
        }

        .status-closed {
            background: #991b1b;
            color: #fecaca;
        }

        .edit-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--brand-red);
            color: var(--brand-red);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .edit-btn:hover {
            background: var(--brand-red);
            color: white;
        }

        /* Form Styles */
        .form-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .form-section h2 {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--brand-red);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 500;
            color: #94a3b8;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-main);
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--brand-red);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input[type="file"] {
            padding: 10px;
        }

        /* Checkboxes */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--brand-red);
            cursor: pointer;
        }

        .checkbox-item span {
            font-size: 14px;
        }

        /* Distance Repeater */
        .distance-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .distance-item {
            background: var(--input-bg);
            border-radius: 8px;
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
            border: 1px solid var(--border-color);
        }

        .distance-item input {
            padding: 10px 12px;
            border: 1px solid #334155;
            border-radius: 6px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 14px;
        }

        .distance-item label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 4px;
            display: block;
        }

        .remove-distance {
            padding: 10px;
            background: #7f1d1d;
            border: none;
            color: #fecaca;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .add-distance {
            padding: 12px 20px;
            background: transparent;
            border: 2px dashed #334155;
            color: #94a3b8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .add-distance:hover {
            border-color: #f97316;
            color: #f97316;
        }

        /* Pricing Tiers */
        .pricing-tier {
            background: #0f172a;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .pricing-tier h4 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #e2e8f0;
        }

        .pricing-tier .form-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        /* AI Theme Section */
        .ai-theme-section {
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--brand-dark) 100%);
            border: 1px solid var(--brand-red);
        }

        .ai-prompt-area {
            position: relative;
        }

        .ai-prompt-area textarea {
            min-height: 100px;
        }

        .generate-theme-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--brand-red) 0%, #b00e26 100%);
            border: none;
            color: white;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.2s;
        }

        .generate-theme-btn:hover {
            transform: scale(1.05);
        }

        .generate-theme-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .theme-preview {
            margin-top: 20px;
            padding: 20px;
            background: var(--input-bg);
            border-radius: 8px;
            display: none;
            border: 1px solid var(--border-color);
        }

        .theme-preview.visible {
            display: block;
        }

        .theme-preview h4 {
            margin-bottom: 16px;
            font-size: 14px;
            color: #94a3b8;
        }

        .color-swatches {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            border: 1px solid #334155;
        }

        .color-swatch-group {
            flex: 1;
            min-width: 140px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-swatch-group label {
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .color-swatch-group input[type="color"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 48px;
            height: 48px;
            background-color: transparent;
            border: 2px solid #334155;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
        }

        .color-swatch-group input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-swatch-group input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }

        .color-swatch-group input[type="color"]:hover {
            transform: scale(1.05);
            border-color: var(--brand-red);
        }

        .color-swatch-group input[type="text"] {
            width: 100%;
            padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            text-transform: uppercase;
        }

        .generated-tagline {
            background: #334155;
            padding: 12px 16px;
            border-radius: 6px;
            font-style: italic;
            margin-top: 12px;
        }

        /* Included Items */
        .included-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            padding-top: 24px;
            border-top: 1px solid #334155;
            margin-top: 24px;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #475569;
            color: #94a3b8;
        }

        .btn-secondary:hover {
            border-color: #64748b;
            color: #e2e8f0;
        }

        .btn-primary {
            background: var(--brand-red);
            border: none;
            color: white;
            text-transform: uppercase;
            font-weight: 700;
        }

        .btn-primary:hover {
            background: #ea580c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .distance-item {
                grid-template-columns: 1fr 1fr;
            }

            .pickup-item,
            .beneficiary-item,
            .sponsor-item {
                grid-template-columns: 1fr;
            }

            .pickup-item .form-group[style*="grid-column: span"] {
                grid-column: 1 / -1 !important;
            }

            .pricing-tier .form-grid {
                grid-template-columns: 1fr;
            }

            .race-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                text-align: center;
            }

            .admin-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }

        /* Repeater Styles */
        .repeater-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
        }

        .repeater-item {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            position: relative;
            display: grid;
            gap: 12px;
        }

        .repeater-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #334155;
        }

        .repeater-item-header h5 {
            color: #94a3b8;
            font-size: 12px;
            text-transform: uppercase;
        }

        .remove-btn {
            background: #ef444422;
            color: #ef4444;
            border: 1px solid #ef444444;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .remove-btn:hover {
            background: #ef4444;
            color: white;
        }

        .add-btn {
            padding: 10px 16px;
            background: transparent;
            border: 2px dashed #334155;
            color: #94a3b8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            width: fit-content;
        }

        .add-btn:hover {
            border-color: var(--brand-red);
            color: var(--brand-red);
        }

        .pickup-item {
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
        }

        .beneficiary-item,
        .sponsor-item {
            grid-template-columns: 1fr 1fr auto;
        }

        /* Media Upload Styles */
        .media-block {
            margin-bottom: 28px;
            padding-bottom: 28px;
            border-bottom: 1px solid var(--border-color);
        }

        .media-block:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .media-block h4 {
            font-size: 16px;
            margin-bottom: 4px;
            color: #e2e8f0;
        }

        .media-hint {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 16px;
        }

        .input-with-button {
            display: flex;
            gap: 8px;
        }

        .input-with-button input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #334155;
            border-radius: 8px;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 14px;
        }

        .input-with-button input:focus {
            outline: none;
            border-color: var(--brand-red);
        }

        .preview-btn {
            padding: 12px 20px;
            background: #334155;
            border: none;
            color: #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .preview-btn:hover {
            background: var(--brand-red);
            color: white;
        }

        .youtube-preview {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
            background: #0f172a;
        }

        .youtube-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .youtube-placeholder span {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .youtube-preview iframe {
            width: 100%;
            aspect-ratio: 16/9;
            border: none;
        }

        .image-upload-area {
            border: 2px dashed #334155;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #0f172a;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .image-upload-area:hover {
            border-color: var(--brand-red);
            background: var(--brand-grey);
        }

        .image-upload-area.has-image {
            padding: 0;
            border-style: solid;
        }

        .thumbnail-upload {
            max-width: 250px;
            aspect-ratio: 1;
            min-height: 0;
        }

        .upload-placeholder {
            color: #64748b;
        }

        .upload-placeholder span {
            font-size: 48px;
            display: block;
            margin-bottom: 12px;
        }

        .upload-placeholder p {
            margin-bottom: 4px;
        }

        .upload-placeholder small {
            font-size: 12px;
            color: #475569;
        }

        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .clear-image-btn {
            margin-top: 8px;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #7f1d1d;
            color: #fca5a5;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .clear-image-btn:hover {
            background: #7f1d1d;
            color: #fecaca;
        }

        /* Drag and drop states */
        .image-upload-area.dragover {
            border-color: var(--brand-red);
            background: var(--brand-grey);
        }

        .flex-center-gap-15 {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .flex-gap-15-center {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .view-site-link {
            color: var(--brand-red);
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
        }

        .admin-logo-small {
            height: 50px;
        }

        .help-text {
            color: #888;
            display: block;
            margin-top: 4px;
        }

        /* Helper classes for refactoring */
        .color-slate {
            color: #94a3b8;
        }

        .color-ccc {
            color: #ccc;
        }

        .color-888 {
            color: #888;
        }

        .color-red-danger {
            color: #ef4444;
        }

        .fw-700 {
            font-weight: 700;
        }

        .fw-800 {
            font-weight: 800;
        }

        .ls-2px {
            letter-spacing: 2px;
        }

        .fs-40px {
            font-size: 40px;
        }

        .fs-12px {
            font-size: 12px;
        }

        .fs-3-5rem {
            font-size: 3.5rem;
        }

        .w-100 {
            width: 100%;
        }

        .break-all {
            word-break: break-all;
        }

        .mt-5 {
            margin-top: 5px !important;
        }

        .mt-10 {
            margin-top: 10px !important;
        }

        .mt-15 {
            margin-top: 15px !important;
        }

        .mt-20 {
            margin-top: 20px !important;
        }

        .mt-30 {
            margin-top: 30px !important;
        }

        .mt-40 {
            margin-top: 40px !important;
        }

        .mb-15 {
            margin-bottom: 15px !important;
        }

        .mb-16 {
            margin-bottom: 16px !important;
        }

        .mb-40 {
            margin-bottom: 40px !important;
        }

        .pt-30 {
            padding-top: 30px !important;
        }

        .full-width-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #333;
            color: white;
        }

        .carousel-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .preview-contain-pad {
            object-fit: contain;
            padding: 10px;
        }

        .danger-border-top {
            border-top: 2px solid #ef4444;
        }

        .danger-confirm-box {
            background: rgba(239, 68, 68, 0.1);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ef4444;
        }

        .danger-confirm-text {
            color: #ef4444;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .btn-danger-outline {
            background: transparent;
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .btn-danger-solid {
            background: #ef4444;
            color: white;
            border: none;
            font-weight: 800;
        }

        .flex-centered-gap-8 {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .display-none {
            display: none !important;
        }
    </style>
</head>

<body>

    <!-- Password Gate -->
    <div class="password-gate" id="passwordGate">
        <div class="password-box">
            <img src="../../attached_assets/why-racing-logo_1767589311719.png" alt="Why Racing Logo"
                class="logo-placeholder">
            <h1>Race Admin Panel</h1>
            <p>Enter password to access the dashboard</p>
            <input type="password" id="passwordInput" placeholder="Password"
                onkeypress="if(event.key==='Enter')checkPassword()">
            <button onclick="checkPassword()">Enter Dashboard</button>
            <p class="password-error" id="passwordError">Incorrect password. Try again.</p>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <header class="admin-header">
            <div class="flex-center-gap-15">
                <img src="../../attached_assets/why-racing-logo_1767589311719.png" alt="Why Racing Logo"
                    class="admin-logo-small">
                <h1>Events Admin</h1>
            </div>
            <div class="flex-gap-15-center">
                <a href="../../index.html" class="view-site-link">‚Üê View Live Site</a>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('races')">All Races</button>
            <button class="tab-btn" onclick="switchTab('add')">+ Add New Race</button>
        </div>

        <!-- Tab: Race List -->
        <div class="tab-content active" id="tab-races">
            <div class="race-list" id="raceList">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Tab: Add/Edit Race -->
        <div class="tab-content" id="tab-add">
            <form id="raceForm">

                <!-- Visibility & Status -->
                <div class="form-section">
                    <h2>üìã Visibility & Status</h2>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="isActive" checked>
                            <span>Race visible on site</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="registrationOpen">
                            <span>Registration open</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="isFeatured">
                            <span>Featured on homepage</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="waitlistEnabled">
                            <span>Waitlist enabled when full</span>
                        </label>
                    </div>
                </div>

                <!-- Basic Info -->
                <div class="form-section">
                    <h2>üìù Basic Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="raceName">Race Name *</label>
                            <input type="text" id="raceName" name="raceName" placeholder="e.g., Haunted Half Marathon"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="raceDate">Race Date *</label>
                            <input type="date" id="raceDate" name="raceDate" required>
                        </div>

                        <div class="form-group">
                            <label for="raceType">Race Type</label>
                            <select id="raceType" name="raceType">
                                <option value="running">Running</option>
                                <option value="trail">Trail Running</option>
                                <option value="triathlon">Triathlon</option>
                                <option value="duathlon">Duathlon</option>
                                <option value="kids">Kids Race</option>
                                <option value="virtual">Virtual</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="venue">Venue Name</label>
                            <input type="text" id="venue" name="venue" placeholder="e.g., Lacamas Lake Regional Park">
                        </div>

                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" placeholder="e.g., Camas">
                        </div>
                        <div class="form-group">
                            <label for="state">State</label>
                            <select id="state" name="state">
                                <option value="WA">Washington</option>
                                <option value="OR">Oregon</option>
                                <option value="ID">Idaho</option>
                            </select>
                        </div>




                        <div class="form-group full-width">
                            <label for="registrationUrl">Registration URL (RunSignUp) *</label>
                            <input type="url" id="registrationUrl" name="registrationUrl"
                                placeholder="https://runsignup.com/Race/WA/Vancouver/YourRaceName">
                            <small class="help-text">Paste the full RunSignUp URL
                                where
                                participants can register</small>
                        </div>
                    </div>
                </div>

                <!-- Distances & Pricing -->
                <div class="form-section">
                    <h2>üèÖ Distances & Pricing</h2>
                    <div class="distance-list" id="distanceList">
                        <div class="distance-item">
                            <div>
                                <label>Distance Type</label>
                                <select name="distanceName[]" onchange="autoFillDistance(this)"
                                    class="full-width-select">
                                    <option value="">-- Select Distance --</option>
                                    <option value="5K">5K</option>
                                    <option value="10K">10K</option>
                                    <option value="15K">15K</option>
                                    <option value="Half Marathon">Half Marathon</option>
                                    <option value="Marathon">Marathon</option>
                                    <option value="50K Ultra">50K Ultra</option>
                                    <option value="100K Ultra">100K Ultra</option>
                                    <option value="100 Mile">100 Mile</option>
                                    <option value="Kids Run">Kids Run</option>
                                    <option value="1 Mile">1 Mile</option>
                                    <option value="Sprint Triathlon">Sprint Triathlon</option>
                                    <option value="Olympic Triathlon">Olympic Triathlon</option>
                                    <option value="Half Ironman">Half Ironman</option>
                                    <option value="Trail Run">Trail Run</option>
                                    <option value="Virtual">Virtual</option>
                                </select>
                            </div>
                            <div>
                                <label>Distance Value</label>
                                <input type="text" name="distanceValue[]" placeholder="e.g., 3.1 miles">
                            </div>

                            <div>
                                <label>Base Price</label>
                                <input type="number" name="distancePrice[]" placeholder="75" step="0.01">
                            </div>

                            <button type="button" class="remove-distance" onclick="removeDistance(this)">√ó</button>
                        </div>
                    </div>
                    <button type="button" class="add-distance" onclick="addDistance()">+ Add Another Distance</button>
                </div>







                <!-- Beneficiaries & Sponsors -->
                <div class="form-section">
                    <h2>ü§ù Partners & Causes</h2>

                    <div class="repeater-container">
                        <h3>‚ù§Ô∏è Beneficiaries</h3>
                        <div id="beneficiaryList" class="repeater-list">
                            <!-- Populated by JS -->
                        </div>
                        <button type="button" class="add-btn" onclick="addBeneficiary()">+ Add Beneficiary</button>
                    </div>

                    <div class="repeater-container mt-30">
                        <h3>ü§ù Sponsors</h3>
                        <div id="sponsorList" class="repeater-list">
                            <!-- Populated by JS -->
                        </div>
                        <button type="button" class="add-btn" onclick="addSponsor()">+ Add Sponsor</button>
                    </div>
                </div>







                <!-- Media -->
                <div class="form-section">
                    <h2>üì∏ Media</h2>







                    <!-- Thumbnail Image -->
                    <div class="media-block">
                        <h4>üè∑Ô∏è Race Thumbnail</h4>
                        <p class="media-hint">Square image for race cards and listings (recommended: 800x800)</p>
                        <div class="form-group">
                            <div class="image-upload-area thumbnail-upload" id="thumbnailUploadArea"
                                onclick="document.getElementById('thumbnailImage').click()">
                                <input type="file" id="thumbnailImage" name="thumbnailImage" accept="image/*"
                                    onchange="previewImage(this, 'thumbnailPreview')" hidden>
                                <div class="upload-placeholder" id="thumbnailPlaceholder">
                                    <span>üìÅ</span>
                                    <p>Click to upload</p>
                                    <small>Square image</small>
                                </div>
                                <img id="thumbnailPreview" class="image-preview display-none">
                            </div>
                            <button type="button" class="clear-image-btn display-none" onclick="clearImage('thumbnail')"
                                id="thumbnailClearBtn">‚úï Remove</button>
                        </div>
                    </div>


                </div>



                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                    <button type="button" class="btn btn-secondary display-none" id="viewLiveBtn"
                        onclick="window.open('../events/race-detail.html?id=' + document.getElementById('raceForm').dataset.editingId, '_blank')">View
                        Live</button>
                    <button type="button" class="btn btn-secondary" onclick="saveDraft()">Save as Draft</button>
                    <button type="submit" class="btn btn-primary">Save & Publish Race</button>
                </div>

                <!-- Delete Section (only visible when editing) -->
                <div id="deleteSection" class="display-none mt-40 pt-30 danger-border-top">
                    <h4 class="color-red-danger mb-15">‚ö†Ô∏è Danger Zone</h4>
                    <p class="color-slate mb-15">Permanently delete this race and all associated
                        data. This action cannot be undone.</p>

                    <!-- Step 1: Initial Button -->
                    <div id="deleteStep1">
                        <button type="button" class="btn btn-danger-outline" onclick="showDeleteConfirm()">
                            üóëÔ∏è Delete This Race
                        </button>
                    </div>

                    <!-- Step 2: Confirmation Buttons -->
                    <div id="deleteStep2" class="display-none danger-confirm-box">
                        <p class="danger-confirm-text">Are you absolutely sure? This
                            cannot be undone.</p>
                        <div class="flex-centered-gap-8">
                            <button type="button" class="btn btn-danger-solid" onclick="finalDeleteRace()">
                                YES, DELETE PERMANENTLY
                            </button>
                            <button type="button" class="btn btn-secondary"
                                onclick="hideDeleteConfirm()">Cancel</button>
                        </div>
                    </div>
                </div>

            </form>
        </div>

    </div>

    <script>
        // === Configuration ===
        const ADMIN_PASSWORD = 'why26';
        const ADMIN_SECRET = 'why2026';

        // API endpoint for AI theme generation
        const AI_ENDPOINT = '/api/generate-theme';
        const RACES_ENDPOINT = '/api/races';

        // === Password Protection ===
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === ADMIN_PASSWORD) {
                sessionStorage.setItem('raceAdminAuth', 'true');
                sessionStorage.setItem('ADMIN_SECRET', ADMIN_SECRET);
                document.getElementById('passwordGate').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadRaces();
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
            }
        }

        function logout() {
            sessionStorage.removeItem('raceAdminAuth');
            sessionStorage.removeItem('ADMIN_SECRET');
            document.getElementById('passwordGate').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
        }

        // Check if already authenticated
        if (sessionStorage.getItem('raceAdminAuth') === 'true') {
            document.getElementById('passwordGate').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadRaces();
        }

        // === Tab Navigation ===
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Handle the case where switchTab is called via onclick="(event) => switchTab(...)"
            if (typeof event !== 'undefined' && event.target && event.target.classList.contains('tab-btn')) {
                event.target.classList.add('active');
            } else {
                // Find corresponding button
                const btns = document.querySelectorAll('.tab-btn');
                if (tabName === 'races') btns[0].classList.add('active');
                else if (tabName === 'add') btns[1].classList.add('active');
            }

            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // === Race List ===
        let races = [];

        async function loadRaces() {
            try {
                const response = await fetch(RACES_ENDPOINT, {
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('ADMIN_SECRET')
                    }
                });
                if (response.ok) {
                    races = await response.json();
                    renderRaceList();
                }
            } catch (error) {
                console.error('Failed to load races:', error);
            }
        }

        function renderRaceList() {
            const list = document.getElementById('raceList');
            if (races.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px;">No races found. Add your first race!</p>';
                return;
            }

            const today = new Date().toISOString().split('T')[0];

            list.innerHTML = races.map(race => {
                const isPastDraft = race.status === 'draft' && race.race_date && race.race_date < today;
                const readyBadge = isPastDraft ? '<span style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 8px; border-radius: 4px; margin-left: 8px;">üìÖ Ready to Update</span>' : '';

                return `
        <div class="race-card" style="${isPastDraft ? 'border-left: 3px solid #f59e0b;' : ''}">
          <div class="race-card-info">
            <h3>${race.name}${readyBadge}</h3>
            <p>${formatDate(race.race_date)} ‚Ä¢ ${race.city || ''}, ${race.state || 'WA'}</p>
          </div>
          <div class="race-card-status">
            <span class="status-badge status-${race.status}">${race.status}</span>
            <a href="../events/race-detail.html?id=${race.id}" target="_blank" class="edit-btn" style="text-decoration: none; border-color: #475569; color: #94a3b8;">View Live</a>
            <button class="edit-btn" onclick="editRace('${race.id}')">Edit</button>
          </div>
        </div>
      `;
            }).join('');
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'TBA';
            return new Date(dateStr).toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function editRace(id) {
            const race = races.find(r => r.id === id);
            if (!race) return;

            switchTab('add');

            const form = document.getElementById('raceForm');
            form.dataset.editingId = id;

            // Fill basic info
            console.log('Editing race:', race.name, '(ID: ' + race.id + ')');
            if (document.getElementById('raceName')) {
                document.getElementById('raceName').value = race.name || '';
            } else {
                console.error('CRITICAL: raceName input not found in DOM!');
            }
            form.raceDate.value = race.race_date || '';
            form.isActive.checked = race.is_visible;
            form.registrationOpen.checked = race.registration_open;
            form.isFeatured.checked = race.is_featured;
            form.waitlistEnabled.checked = race.waitlist_enabled;

            // Show View Live button and Delete section
            document.getElementById('viewLiveBtn').style.display = 'inline-block';
            document.getElementById('deleteSection').style.display = 'block';


            // Handle distances
            const distanceList = document.getElementById('distanceList');
            distanceList.innerHTML = '';
            if (race.race_distances && race.race_distances.length > 0) {
                race.race_distances.forEach(d => {
                    addDistanceWithValue(d.name, d.distance_value, d.capacity, d.base_price, d.start_time, d.standard_price);
                });
            } else {
                addDistance();
            }



            if (race.thumbnail_url) {
                const preview = document.getElementById('thumbnailPreview');
                preview.src = race.thumbnail_url;
                preview.style.display = 'block';
                document.getElementById('thumbnailPlaceholder').style.display = 'none';
                document.getElementById('thumbnailUploadArea').classList.add('has-image');
                document.getElementById('thumbnailClearBtn').style.display = 'inline-block';
            }


        }

        function addDistanceWithValue(name = '', distance = '', capacity = '', price = '', startTime = '', standardPrice = '') {
            // Convert null/undefined to empty strings for form inputs
            name = name ?? '';
            distance = distance ?? '';
            capacity = (capacity === null || capacity === undefined) ? '' : capacity;
            price = (price === null || price === undefined) ? '' : price;
            startTime = startTime ?? '';
            standardPrice = (standardPrice === null || standardPrice === undefined) ? '' : standardPrice;

            const list = document.getElementById('distanceList');
            const item = document.createElement('div');
            item.className = 'distance-item';

            const distanceOptions = [
                { value: '', label: '-- Select Distance --' },
                { value: '5K', label: '5K' },
                { value: '10K', label: '10K' },
                { value: '15K', label: '15K' },
                { value: 'Half Marathon', label: 'Half Marathon' },
                { value: 'Marathon', label: 'Marathon' },
                { value: '50K Ultra', label: '50K Ultra' },
                { value: '100K Ultra', label: '100K Ultra' },
                { value: '100 Mile', label: '100 Mile' },
                { value: 'Kids Run', label: 'Kids Run' },
                { value: '1 Mile', label: '1 Mile' },
                { value: 'Sprint Triathlon', label: 'Sprint Triathlon' },
                { value: 'Olympic Triathlon', label: 'Olympic Triathlon' },
                { value: 'Half Ironman', label: 'Half Ironman' },
                { value: 'Trail Run', label: 'Trail Run' },
                { value: 'Virtual', label: 'Virtual' }
            ];

            const optionsHtml = distanceOptions.map(opt =>
                `<option value="${opt.value}" ${opt.value === name ? 'selected' : ''}>${opt.label}</option>`
            ).join('');

            item.innerHTML = `
        <div>
          <label>Distance Type</label>
          <select name="distanceName[]" onchange="autoFillDistance(this)" style="width: 100%; padding: 10px; border: 1px solid #444; border-radius: 6px; background: #333; color: white;">
            ${optionsHtml}
          </select>
        </div>
        <div>
          <label>Distance Value</label>
          <input type="text" name="distanceValue[]" value="${distance}" placeholder="e.g., 3.1 miles">
        </div>
        <div>
          <label>Capacity</label>
          <input type="number" name="distanceCapacity[]" value="${capacity}" placeholder="500">
        </div>
        <div>
          <label>Base Price</label>
          <input type="number" name="distancePrice[]" value="${price}" placeholder="75" step="0.01">
        </div>
        <div>
          <label>Standard Price</label>
          <input type="number" name="distanceStandardPrice[]" value="${standardPrice}" placeholder="90" step="0.01">
        </div>
        <div>
          <label>Start Time</label>
          <input type="time" name="distanceStartTime[]" value="${startTime}">
        </div>
        <button type="button" class="remove-distance" onclick="removeDistance(this)">√ó</button>
      `;
            list.appendChild(item);
        }

        // === Distance Repeater ===
        function addDistance() {
            addDistanceWithValue();
        }

        function removeDistance(btn) {
            const items = document.querySelectorAll('.distance-item');
            if (items.length > 1) {
                btn.parentElement.remove();
            }
        }




        // Standard distance values - auto-fills when distance type is selected
        const distanceValues = {
            '5K': '3.1 miles',
            '10K': '6.2 miles',
            '15K': '9.3 miles',
            'Half Marathon': '13.1 miles',
            'Marathon': '26.2 miles',
            '50K Ultra': '31.1 miles',
            '100K Ultra': '62.1 miles',
            '100 Mile': '100 miles',
            '1 Mile': '1 mile',
            'Kids Run': '', // Variable - user enters
            'Sprint Triathlon': '', // Variable
            'Olympic Triathlon': '', // Variable
            'Half Ironman': '70.3 miles total',
            'Trail Run': '', // Variable
            'Virtual': '' // Variable
        };

        // Auto-fill distance value when distance type is selected
        function autoFillDistance(selectElement) {
            const distanceItem = selectElement.closest('.distance-item');
            const valueInput = distanceItem.querySelector('input[name="distanceValue[]"]');
            const selectedDistance = selectElement.value;

            if (distanceValues[selectedDistance]) {
                valueInput.value = distanceValues[selectedDistance];
            } else if (selectedDistance === '') {
                valueInput.value = '';
            }
            // If no preset value, leave the field as-is (user can enter custom)
        }



        // === Form Actions ===
        function clearForm() {
            if (confirm('Clear all form data?')) {
                const form = document.getElementById('raceForm');
                form.reset();
                delete form.dataset.editingId;
                document.getElementById('viewLiveBtn').style.display = 'none';
                document.getElementById('deleteSection').style.display = 'none';
                clearImage('thumbnail');

                // Clear repeaters
                document.getElementById('distanceList').innerHTML = '';
                addDistance(); // Add one default distance

            }
        }

        // === Delete Functions ===
        function showDeleteConfirm() {
            document.getElementById('deleteStep1').style.display = 'none';
            document.getElementById('deleteStep2').style.display = 'block';
        }

        function hideDeleteConfirm() {
            document.getElementById('deleteStep1').style.display = 'block';
            document.getElementById('deleteStep2').style.display = 'none';
        }

        async function finalDeleteRace() {
            const form = document.getElementById('raceForm');
            const editingId = form.dataset.editingId;

            if (!editingId) return;

            try {
                const response = await fetch(`/api/races/${editingId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('ADMIN_SECRET')
                    }
                });

                if (response.ok) {
                    alert('Race deleted permanently.');
                    // Manually clear form elements and hide sections
                    form.reset();
                    delete form.dataset.editingId;
                    document.getElementById('viewLiveBtn').style.display = 'none';
                    document.getElementById('deleteSection').style.display = 'none';
                    hideDeleteConfirm(); // Reset the buttons for next time
                    switchTab('races');
                    loadRaces();
                } else {
                    const data = await response.json();
                    alert('Failed to delete race: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('Failed to delete race: ' + error.message);
            }
        }

        async function saveRace(status = 'active') {
            const form = document.getElementById('raceForm');
            const formData = new FormData(form);
            const editingId = form.dataset.editingId;

            // Generate a temporary ID if this is a new race
            const raceId = editingId || 'temp-' + Date.now();

            // Upload images first
            let thumbnailImageUrl = null;

            const thumbnailFile = document.getElementById('thumbnailImage').files[0];


            if (thumbnailFile) {
                try {
                    const uploadFormData = new FormData();
                    uploadFormData.append('file', thumbnailFile);
                    uploadFormData.append('type', 'thumbnail');
                    uploadFormData.append('raceId', raceId);

                    const uploadRes = await fetch('/api/races/upload', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + sessionStorage.getItem('ADMIN_SECRET')
                        },
                        body: uploadFormData
                    });

                    if (uploadRes.ok) {
                        const uploadData = await uploadRes.json();
                        thumbnailImageUrl = uploadData.url;
                        console.log('Thumbnail image uploaded:', thumbnailImageUrl);
                    } else {
                        const errorText = await uploadRes.text();
                        console.error('Thumbnail upload failed:', errorText);
                        alert('Thumbnail image upload failed: ' + errorText);
                    }
                } catch (err) {
                    console.error('Thumbnail upload error:', err);
                    alert('Thumbnail image upload error: ' + err.message);
                }
            }





            // Extract distances
            const dNames = formData.getAll('distanceName[]');
            const dValues = formData.getAll('distanceValue[]');
            const dCapacities = formData.getAll('distanceCapacity[]');
            const dPrices = formData.getAll('distancePrice[]');
            const dStandardPrices = formData.getAll('distanceStandardPrice[]');
            const dStartTimes = formData.getAll('distanceStartTime[]');

            const distances = dNames.map((name, i) => ({
                name,
                distance_value: dValues[i],
                capacity: parseInt(dCapacities[i]) || null,
                base_price: parseFloat(dPrices[i]) || 0,
                standard_price: parseFloat(dStandardPrices[i]) || null,
                start_time: dStartTimes[i] || null
            })).filter(d => d.name);

            const payload = {
                name: formData.get('raceName'),
                race_date: formData.get('raceDate'),
                race_type: formData.get('raceType'),
                venue: formData.get('venue'),
                city: formData.get('city'),
                state: formData.get('state'),
                registration_url: formData.get('registrationUrl'),
                status: status,
                is_visible: formData.get('isActive') === 'on',
                is_featured: formData.get('isFeatured') === 'on',
                waitlist_enabled: formData.get('waitlistEnabled') === 'on',
                thumbnail_url: thumbnailImageUrl || (editingId ? races.find(r => r.id === editingId)?.thumbnail_url : null),
                distances: distances
            };

            try {
                const url = editingId ? `${RACES_ENDPOINT}/${editingId}` : RACES_ENDPOINT;
                const method = editingId ? 'PUT' : 'POST';
                const authSecret = sessionStorage.getItem('ADMIN_SECRET') || ADMIN_SECRET;

                console.log('Saving race:', { url, method, authSecret: authSecret ? 'present' : 'missing' });
                console.log('Payload:', payload);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authSecret
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                console.log('Server response:', result);

                if (response.ok) {
                    alert('Race saved successfully!');
                    if (confirm('Race saved! Would you like to view the live page?')) {
                        window.open(`../events/race-detail.html?id=${result.id || editingId}`, '_blank');
                    }
                    clearForm();
                    switchTab('races');
                    loadRaces();
                } else {
                    alert('Failed to save race: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                console.error('Save error:', e);
                alert('Error saving race: ' + e.message);
            }
        }

        function saveDraft() {
            saveRace('draft');
        }

        document.getElementById('raceForm').addEventListener('submit', function (e) {
            e.preventDefault();
            saveRace('active');
        });


        // === Image Upload & Preview ===
        function validateImage(file) {
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];

            if (!allowedTypes.includes(file.type)) {
                alert('Please use JPG, PNG, or WebP images only');
                return false;
            }

            if (file.size > maxSize) {
                alert('Image must be under 5MB');
                return false;
            }

            return true;
        }


        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const placeholder = document.getElementById(previewId.replace('Preview', 'Placeholder'));
            const uploadArea = document.getElementById(previewId.replace('Preview', 'UploadArea'));
            const clearBtn = document.getElementById(previewId.replace('Preview', 'ClearBtn'));

            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (!validateImage(file)) {
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    uploadArea.classList.add('has-image');
                    clearBtn.style.display = 'inline-block';
                };

                reader.readAsDataURL(file);
            }
        }

        function clearImage(type) {
            const input = document.getElementById(type + 'Image');
            const preview = document.getElementById(type + 'Preview');
            const placeholder = document.getElementById(type + 'Placeholder');
            const uploadArea = document.getElementById(type + 'UploadArea');
            const clearBtn = document.getElementById(type + 'ClearBtn');

            if (input) input.value = '';
            if (preview) {
                preview.src = '';
                preview.style.display = 'none';
            }
            if (placeholder) placeholder.style.display = 'block';
            if (uploadArea) uploadArea.classList.remove('has-image');
            if (clearBtn) clearBtn.style.display = 'none';
        }



        // Initialize with empty slots if needed
        document.addEventListener('DOMContentLoaded', function () {
            if (document.getElementById('gallerySlots') && document.querySelectorAll('.gallery-slot').length === 0) {
                addGallerySlot();
            }
            if (document.getElementById('carouselSlots') && document.querySelectorAll('.carousel-slot').length === 0) {
                // We don't necessarily need empty carousel slots by default, but we can add one
                // addCarouselSlot();
            }
        });

        // === Drag and Drop ===
    </script>

</body>

</html>
